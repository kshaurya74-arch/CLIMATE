<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VayuVision | Climate Data Hackathon 2026</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700;800&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">

    <style>
        /* --- THEME COLORS --- */
        :root {
            --bg-dark: #050505;
            --card-bg: rgba(20, 20, 20, 0.6);
            --glass-border: rgba(255, 255, 255, 0.08);
            --neon-green: #00ff9d;
            --neon-red: #ff0000; 
            --danger-red: #ff003c; 
            --neon-blue: #00d2ff;
            --neon-yellow: #f1c40f;
            --text-main: #ffffff;
            --text-muted: #888888;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Open Sans', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-main);
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* --- SEAMLESS VIDEO BACKGROUND --- */
        .bg-video {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            object-fit: cover;
            object-position: center center;
            z-index: -2;
            transition: opacity 2s ease-in-out; /* 2 second smooth fade */
        }

        .video-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(rgba(0, 0, 0, 0.85), rgba(0, 0, 0, 0.7));
            z-index: -1;
        }

        /* --- NAVIGATION --- */
        nav {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 550px;
            background: rgba(10, 10, 10, 0.9);
            backdrop-filter: blur(12px);
            padding: 12px 25px;
            border-radius: 50px;
            border: 1px solid var(--glass-border);
            z-index: 9999;
            display: flex;
            justify-content: space-between;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }

        nav a {
            color: var(--text-muted);
            text-decoration: none;
            font-size: 0.8rem;
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            cursor: pointer;
        }

        nav a i { font-size: 1.1rem; margin-bottom: 2px; }

        nav a:hover, nav a.active {
            color: var(--neon-green);
            text-shadow: 0 0 12px rgba(0, 255, 157, 0.4);
        }

        /* --- SECTIONS --- */
        section {
            display: none;
            min-height: 100vh;
            padding: 110px 20px 40px 20px;
            flex-direction: column;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            animation: fadeIn 0.5s ease-in-out;
        }
        
        section.active-section { display: flex; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1, h2, h3 { 
            font-family: 'Montserrat', sans-serif; 
            text-transform: uppercase; 
            letter-spacing: -0.5px;
        }
        
        h2 { 
            font-size: 2.5rem; 
            font-weight: 800;
            margin-bottom: 40px; 
            background: linear-gradient(90deg, #fff, var(--text-muted)); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
            text-align: center;
        }

        /* --- COMPONENTS --- */
        .glass-card {
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 30px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s ease, border-color 0.3s;
            width: 100%;
        }
        
        .glass-card h4 {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.5rem; 
            font-weight: 700;
            letter-spacing: 0.5px;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 10px;
        }

        .glass-card:hover {
            transform: translateY(-5px);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .location-badge {
            background: rgba(0, 255, 157, 0.1);
            color: var(--neon-green);
            padding: 8px 20px;
            border-radius: 30px;
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            border: 1px solid rgba(0, 255, 157, 0.2);
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse { 0% { opacity: 0.8; } 50% { opacity: 1; box-shadow: 0 0 15px rgba(0,255,157,0.2); } 100% { opacity: 0.8; } }

        /* --- ANIMATED AQI CIRCLE --- */
        .aqi-wrapper {
            position: relative;
            width: 320px;
            height: 320px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 20px 0;
        }

        .aqi-svg {
            transform: rotate(-90deg);
            width: 100%;
            height: 100%;
        }

        .aqi-circle-bg {
            fill: none;
            stroke: #222;
            stroke-width: 15;
        }

        .aqi-circle-progress {
            fill: none;
            stroke: var(--neon-green); 
            stroke-width: 15;
            stroke-linecap: round;
            stroke-dasharray: 880; 
            stroke-dashoffset: 880; 
            transition: stroke-dashoffset 2s ease-out, stroke 1s ease, filter 1s ease;
            filter: drop-shadow(0 0 15px var(--neon-green));
        }

        .aqi-inner-content {
            position: absolute;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .aqi-number { 
            font-family: 'Montserrat', sans-serif;
            font-size: 5rem; 
            font-weight: 800; 
            color: #fff; 
            line-height: 1;
            text-shadow: 0 0 20px rgba(0,0,0,0.8);
        }
        
        .aqi-label { 
            color: var(--text-muted); 
            font-size: 0.9rem; 
            letter-spacing: 2px; 
            margin-top: 10px;
            font-weight: 600;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            width: 100%;
            margin-top: 40px;
        }

        #home .dashboard-grid {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #home .dashboard-grid .glass-card {
            max-width: 600px;
            width: 100%;
        }

        .action-btn {
            background: transparent;
            border: 1px solid var(--text-muted);
            color: var(--text-main);
            padding: 10px 24px;
            border-radius: 30px;
            cursor: pointer;
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            transition: 0.3s;
        }
        .action-btn:hover, .action-btn.active { border-color: var(--neon-blue); background: rgba(0, 210, 255, 0.1); color: var(--neon-blue); }

        /* --- SOS FLOATING BUTTON --- */
        .sos-fab {
            position: fixed; bottom: 120px; right: 30px; 
            width: 70px; height: 70px;
            background: var(--danger-red);
            border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            box-shadow: 0 0 20px rgba(255, 0, 60, 0.5);
            z-index: 2000; cursor: pointer;
            animation: pulse-red 2s infinite;
            border: 3px solid white; transition: transform 0.2s;
        }
        .sos-fab:hover { transform: scale(1.1); }
        .sos-fab i { color: white; font-size: 1.8rem; }
        @keyframes pulse-red {
            0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(255, 0, 60, 0.7); }
            70% { transform: scale(1); box-shadow: 0 0 0 20px rgba(255, 0, 60, 0); }
            100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(255, 0, 60, 0); }
        }

        /* --- CHATBOT FLOATING BUTTON --- */
        .chat-fab {
            position: fixed; bottom: 30px; right: 30px;
            width: 70px; height: 70px;
            background: rgba(10, 10, 10, 0.9);
            border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            box-shadow: 0 0 20px rgba(0, 210, 255, 0.3);
            z-index: 2000; cursor: pointer;
            border: 2px solid var(--neon-blue); transition: all 0.3s ease;
        }
        .chat-fab:hover { transform: scale(1.1); background: rgba(0, 210, 255, 0.1); box-shadow: 0 0 30px rgba(0, 210, 255, 0.5); }
        .chat-fab i { color: var(--neon-blue); font-size: 1.8rem; }

        /* --- CHATBOT PANEL UI --- */
        .qa-panel {
            display: none;
            position: fixed;
            bottom: 110px;
            right: 30px;
            width: 340px;
            max-height: 500px;
            background: rgba(15, 15, 15, 0.95);
            border: 1px solid var(--neon-blue);
            border-radius: 20px;
            padding: 20px;
            z-index: 10006;
            box-shadow: 0 10px 40px rgba(0,0,0,0.8);
            backdrop-filter: blur(20px);
            animation: slideUpChat 0.3s ease-out;
            font-family: 'Open Sans', sans-serif;
        }
        @keyframes slideUpChat {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .qa-input {
            width: 100%;
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--glass-border);
            color: white;
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 10px;
            font-family: 'Open Sans', sans-serif;
            outline: none;
            transition: 0.3s;
        }
        .qa-input:focus { border-color: var(--neon-blue); background: rgba(0, 210, 255, 0.05); }
        .qa-chat-box {
            height: 300px;
            overflow-y: auto;
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 10px;
            background: rgba(0,0,0,0.5);
            font-size: 0.9rem;
            display: flex;
            flex-direction: column;
        }
        .msg { margin-bottom: 10px; padding: 10px 14px; border-radius: 12px; max-width: 85%; line-height: 1.4; }
        .msg-bot { background: rgba(0, 210, 255, 0.1); color: var(--neon-blue); align-self: flex-start; border-bottom-left-radius: 2px; }
        .msg-user { background: rgba(255,255,255,0.1); color: white; align-self: flex-end; margin-left: auto; border-bottom-right-radius: 2px; }
        .close-chat { cursor: pointer; color: var(--text-muted); transition: 0.3s; font-size: 1.2rem; }
        .close-chat:hover { color: var(--neon-red); }

        /* --- REPORT MODAL --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.85); z-index: 3000;
            display: none; justify-content: center; align-items: center;
            padding: 20px; backdrop-filter: blur(8px);
        }

        .modal-content {
            background: linear-gradient(135deg, rgba(30,30,30,0.95), rgba(50,50,50,0.95));
            border: 2px solid var(--danger-red);
            width: 100%; max-width: 900px; max-height: 90vh;
            overflow-y: auto; border-radius: 30px; padding: 30px;
            position: relative; box-shadow: 0 0 60px rgba(255, 0, 60, 0.4);
            animation: slideUp 0.4s ease;
        }
        @keyframes slideUp { from { transform: translateY(100px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        .close-modal {
            position: absolute; top: 20px; right: 25px;
            color: #fff; font-size: 1.5rem; cursor: pointer;
            background: rgba(255,255,255,0.1); width: 40px; height: 40px;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            transition: 0.3s;
        }
        .close-modal:hover { background: var(--danger-red); }

        .report-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-top: 20px; }
        @media(max-width: 768px) { .report-grid { grid-template-columns: 1fr; } }

        .danger-label { color: var(--danger-red); font-size: 0.85rem; font-weight: bold; margin-bottom: 5px; display: block; letter-spacing: 1px; text-transform: uppercase; font-family: 'Montserrat', sans-serif; }
        .danger-input {
            width: 100%; background: rgba(0, 0, 0, 0.4); border: 1px solid #777;
            color: #fff; padding: 12px; margin-bottom: 12px; border-radius: 8px;
            font-family: 'Open Sans', sans-serif; outline: none; transition: 0.3s;
        }
        .danger-input:focus { border-color: var(--danger-red); background: rgba(50, 0, 0, 0.5); }
        
        .submit-btn {
            background: var(--danger-red); color: white; border: none; width: 100%;
            padding: 15px; font-weight: 700; border-radius: 30px; cursor: pointer;
            text-transform: uppercase; letter-spacing: 2px; transition: 0.3s; margin-top: 10px;
            font-family: 'Montserrat', sans-serif;
        }
        .submit-btn:hover { background: #ff3366; box-shadow: 0 0 25px var(--danger-red); transform: scale(1.02); }

        .action-btn.red-mode { border-color: var(--danger-red); color: var(--danger-red); }
        .action-btn.red-mode:hover { background: rgba(255,0,60,0.1); }

        /* Map Styles */
        #ev-map { width: 100%; height: 60vh; border-radius: 24px; z-index: 1; border: 1px solid var(--glass-border); }
        #report-map { height: 300px; width: 100%; border-radius: 24px; border: 1px solid var(--danger-red); }
        
        .external-map-container { width: 100%; height: 70vh; border-radius: 24px; overflow: hidden; border: 1px solid var(--glass-border); background: #fff; }

        .ev-dashboard { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; width: 100%; margin-bottom: 25px; }
        .ev-stat-card {
            background: linear-gradient(135deg, rgba(20,20,20,0.8), rgba(10,10,10,0.9)); border: 1px solid var(--glass-border);
            border-radius: 20px; padding: 20px; text-align: center; backdrop-filter: blur(10px);
        }
        .ev-stat-card h3 { font-size: 2rem; margin: 10px 0 5px 0; font-family: 'Montserrat', sans-serif; color: #fff; }
        .ev-stat-card p { margin: 0; color: var(--text-muted); font-size: 0.85rem; text-transform: uppercase; font-weight: 700; }
        
        .ev-main-container { display: flex; gap: 20px; width: 100%; height: 60vh; }
        .ev-map-enhanced { flex: 2; border-radius: 24px; border: 1px solid var(--neon-blue); box-shadow: 0 0 20px rgba(0, 210, 255, 0.1); z-index: 1; }
        .ev-sidebar {
            flex: 1; background: var(--card-bg); border: 1px solid var(--glass-border); border-radius: 24px; padding: 20px;
            overflow-y: auto; backdrop-filter: blur(10px); display: flex; flex-direction: column;
        }
        .ev-sidebar::-webkit-scrollbar { width: 6px; }
        .ev-sidebar::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 10px; }
        
        .ev-list-item {
            background: rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.05); padding: 15px; border-radius: 12px; margin-bottom: 12px;
            cursor: pointer; transition: 0.3s;
        }
        .ev-list-item:hover { border-color: var(--neon-blue); background: rgba(0,210,255,0.05); transform: translateX(5px); }
        .ev-list-item h5 { margin: 0 0 5px 0; font-family: 'Montserrat', sans-serif; font-size: 1.05rem; color: #fff; }
        .ev-list-item p { margin: 0; font-size: 0.85rem; color: #aaa; display: flex; align-items: center; }
        
        @keyframes greenPulse {
            0% { box-shadow: 0 0 8px var(--neon-green); }
            50% { box-shadow: 0 0 15px var(--neon-green), 0 0 25px var(--neon-green); }
            100% { box-shadow: 0 0 8px var(--neon-green); }
        }

        .ev-status-dot { display: inline-block; width: 10px; height: 10px; border-radius: 50%; margin-right: 8px; }
        .status-avail { background: var(--neon-green); animation: greenPulse 1.5s infinite; }
        .status-busy { background: var(--neon-yellow); box-shadow: 0 0 8px var(--neon-yellow); }
        .status-down { background: var(--danger-red); box-shadow: 0 0 8px var(--danger-red); }

        @media(max-width: 900px) {
            .ev-dashboard { grid-template-columns: 1fr; }
            .ev-main-container { flex-direction: column; height: auto; }
            .ev-map-enhanced { height: 400px; }
            .ev-sidebar { height: 350px; }
        }

        .grap-list { width: 100%; max-width: 800px; display: flex; flex-direction: column; gap: 15px; }
        .grap-item {
            background: linear-gradient(90deg, rgba(20,20,20,0.8) 0%, rgba(20,20,20,0.4) 100%);
            border-left: 4px solid var(--neon-red); padding: 20px; cursor: pointer; border-radius: 12px; transition: 0.3s;
        }
        .grap-item:hover { background: rgba(255, 0, 0, 0.05); }
        .grap-content { display: none; margin-top: 15px; color: #ccc; font-size: 1rem; line-height: 1.6; }
        .grap-header { display: flex; justify-content: space-between; align-items: center; font-weight: 700; font-size: 1.1rem; font-family: 'Montserrat', sans-serif; }
        
        .stat-bar { 
            display: flex; justify-content: space-between; background: #222; padding: 15px; 
            border-radius: 12px; width: 100%; max-width: 800px; margin-bottom: 20px; border: 1px solid var(--neon-red);
        }

        .chart-container { height: 300px; width: 100%; position: relative; display: flex; justify-content: center; align-items: center; }
        #pollutantChart { filter: drop-shadow(0 0 10px rgba(0, 255, 157, 0.1)); }

        .cause-list { list-style: none; line-height: 2.2; font-size: 1.1rem; }
        .cause-list i { margin-right: 12px; width: 20px; text-align: center; }

        .causes-swap-container { position: relative; width: 100%; height: 210px; }
        .cause-list-wrapper { position: absolute; top: 0; left: 0; width: 100%; height: 100%; transition: opacity 0.4s ease, visibility 0.4s; }
        .causes-chart-wrapper { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; visibility: hidden; transition: opacity 0.4s ease, visibility 0.4s; }
        #causes:hover .cause-list-wrapper { opacity: 0; visibility: hidden; }
        #causes:hover .causes-chart-wrapper { opacity: 1; visibility: visible; }

        .neon-balloon {
            position: fixed; bottom: -100px; left: 30px; width: 60px; height: 75px; 
            background: var(--neon-blue); border-radius: 50% 50% 50% 50% / 40% 40% 60% 60%;
            display: flex; justify-content: center; align-items: center; cursor: pointer; z-index: 10000;
            box-shadow: 0 0 25px var(--neon-blue); border: 2px solid rgba(255, 255, 255, 0.5);
            color: #fff; font-size: 1.5rem; animation: floatUp 12s linear infinite; 
        }
        .neon-balloon::after {
            content: ''; position: absolute; bottom: -10px; left: 50%;
            transform: translateX(-50%); width: 2px; height: 20px; background: rgba(255, 255, 255, 0.3);
        }
        @keyframes floatUp {
            0% { bottom: -100px; transform: translateX(0); }
            25% { transform: translateX(15px) rotate(5deg); }
            50% { transform: translateX(-15px) rotate(-5deg); }
            75% { transform: translateX(10px) rotate(3deg); }
            100% { bottom: 110vh; transform: translateX(0); }
        }

        .fact-popup {
            display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 320px; background: rgba(10, 10, 10, 0.95); backdrop-filter: blur(15px);
            border: 1px solid var(--neon-blue); border-radius: 20px; padding: 25px; z-index: 10001;
            box-shadow: 0 0 50px rgba(0, 210, 255, 0.3); animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes popIn { 0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; } 100% { transform: translate(-50%, -50%) scale(1); opacity: 1; } }
        .fact-popup h4 { color: var(--neon-blue); margin-bottom: 15px; font-family: 'Montserrat', sans-serif; display: flex; justify-content: space-between; }
        .close-fact { cursor: pointer; color: var(--text-muted); }
        .close-fact:hover { color: var(--neon-red); }

        #simulation-canvas { width: 100%; height: 300px; border: 1px solid var(--glass-border); border-radius: 12px; }
        .btn-group { display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap; justify-content: center;}
        .season-btn { margin-right: 10px; }
        .tooltip { position: absolute; display: none; background: rgba(0,0,0,0.8); color: white; padding: 5px 10px; border-radius: 5px; pointer-events: none; font-family: 'Open Sans', sans-serif; font-size: 0.85rem; z-index: 1000; box-shadow: 0 5px 15px rgba(0,0,0,0.5); }
        .timeline { display: flex; overflow-x: auto; width: 100%; margin-bottom: 20px; gap: 15px; padding-bottom: 10px; scroll-snap-type: x proximity; scroll-behavior: smooth; }
        .timeline::-webkit-scrollbar { height: 8px; }
        .timeline::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.05); border-radius: 10px; }
        .timeline::-webkit-scrollbar-thumb { background: var(--neon-blue); border-radius: 10px; }
        
        .timeline-event { 
            min-width: 260px; text-align: center; background: var(--card-bg); border: 1px solid var(--glass-border); 
            border-radius: 24px; padding: 20px; backdrop-filter: blur(10px); box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3); 
            transition: transform 0.3s ease, box-shadow 0.4s ease; display: flex; flex-direction: column; align-items: center; scroll-snap-align: start; 
        }
        .timeline-event:hover { transform: translateY(-5px); box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5), 0 0 20px rgba(255,255,255,0.05); border-color: rgba(255,255,255,0.2); }
        .timeline-event span { font-family: 'Montserrat', sans-serif; font-size: 1.2rem; font-weight: 800; text-transform: uppercase; margin-bottom: 10px; }
        .timeline-event p { margin: 5px 0; font-family: 'Open Sans', sans-serif; }
        .timeline-event p:nth-child(2) { font-weight: 700; color: #fff; }
        .timeline-event p:nth-child(3) { font-weight: bold; font-size: 1.05rem; }
        .timeline-event p:nth-child(4) { color: #ccc; font-size: 0.95rem; line-height: 1.5; }
        
        .timeline-progress { width: 100%; height: 4px; background: rgba(255,255,255,0.1); border-radius: 2px; margin-top: 10px; }
        .progress-bar { height: 100%; background: var(--neon-blue); width: 0; transition: width 0.3s; border-radius: 2px; }
        
        .quiz-question { margin-bottom: 20px; font-family: 'Open Sans', sans-serif; font-size: 1.05rem; }
        .quiz-question p { font-family: 'Montserrat', sans-serif; font-weight: 700; margin-bottom: 10px; color: #fff; }
        .quiz-option { display: block; margin-bottom: 8px; cursor: pointer; color: var(--text-muted); transition: color 0.3s; }
        .quiz-option:hover { color: #fff; }
        #quiz-feedback { margin-top: 20px; color: var(--neon-green); font-family: 'Montserrat', sans-serif; font-weight: 700; line-height: 1.6; }
        
        @media (max-width: 768px) { #simulation-canvas { height: 200px; } }
    </style>
</head>
<body>

    <video autoplay muted playsinline id="bg-video-1" class="bg-video">
        <source src="10354256-hd_1080_1920_30fps.mp4" type="video/mp4">
    </video>
    <video muted playsinline id="bg-video-2" class="bg-video" style="opacity: 0;">
        <source src="10354256-hd_1080_1920_30fps.mp4" type="video/mp4">
    </video>
    <div class="video-overlay"></div>

    <nav>
        <a onclick="switchTab('home')" id="nav-home" class="active"><i class="fas fa-home"></i> Home</a>
        <a onclick="switchTab('maps')" id="nav-maps"><i class="fas fa-map-marked-alt"></i> Zones</a>
        <a onclick="switchTab('rules')" id="nav-rules"><i class="fas fa-gavel"></i> GRAP</a>
        <a onclick="switchTab('ev')" id="nav-ev"><i class="fas fa-bolt"></i> EV Grid</a>
        <a onclick="switchTab('awareness')" id="nav-awareness"><i class="fas fa-lightbulb"></i> Insights</a>
    </nav>

    <div class="neon-balloon" id="balloonBtn" onclick="handleBalloonPop()">
        <i class="fas fa-lightbulb"></i>
    </div>

    <div class="fact-popup" id="factPopup">
        <h4><i class="fas fa-bolt"></i> IMPACT DATA <i class="fas fa-times close-fact" onclick="closeFact()"></i></h4>
        <p id="factText" style="line-height: 1.6; color: #fff;"></p>
    </div>

    <div class="sos-fab" onclick="openReportModal()" title="Report Hazard">
        <i class="fas fa-exclamation-triangle"></i>
    </div>

    <div class="chat-fab" onclick="toggleChatPanel()" title="वायुexa">
        <i class="fas fa-comments"></i>
    </div>

    <div id="chatPanel" class="qa-panel">
        <div style="display:flex; justify-content:space-between; margin-bottom:15px; align-items: center;">
            <h4 style="color: var(--neon-blue); font-family: 'Montserrat', sans-serif; margin: 0; font-size: 1.1rem;"><i class="fas fa-robot"></i> वायुexa AI</h4>
            <i class="fas fa-times close-chat" onclick="toggleChatPanel()"></i>
        </div>
        <div class="qa-chat-box" id="chatWindow">
            <div class="msg msg-bot">Hello! I’m Vayuxa, your personal air quality guardian powered by Mistral AI. I track the invisible so you can breathe clearly.</div>
            <div class="msg msg-bot">Ask me about Health, General Awareness, City Updates, or Prevention Solutions!</div>
        </div>
        <div style="display:flex; gap:8px;">
            <input type="text" id="chatInput" class="qa-input" placeholder="Type a message..." style="margin-bottom:0;" onkeypress="handleChatEnter(event)">
            <button class="action-btn" onclick="sendChatMsg()" style="padding:10px 15px; border-color: var(--neon-blue); color: var(--neon-blue);"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>

    <div id="report-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="close-modal" onclick="closeReportModal()">×</div>
            <div style="text-align: center; margin-bottom: 20px;">
                <h2 style="margin:0; font-size: 1.8rem; background: none; -webkit-text-fill-color: var(--danger-red);"><i class="fas fa-radiation"></i> EMERGENCY REPORT</h2>
                <p style="color:#aaa; font-size: 0.9rem;">Submit hazardous incidents directly to Central Command.</p>
            </div>
            <div class="report-grid">
                <div>
                    <div class="danger-label"><i class="fas fa-crosshairs"></i> PINPOINT INCIDENT</div>
                    <div id="report-map"></div>
                    <button class="action-btn red-mode" onclick="traceIncidentPath()" style="width:100%; margin-top:10px;">
                        <i class="fas fa-route"></i> Trace Path (Me -> Incident)
                    </button>
                    <div style="margin-top:10px; font-size: 0.8rem; color:#aaa;">
                        <i class="fas fa-info-circle"></i> Click map to auto-fill location.
                    </div>
                </div>
                <form onsubmit="submitReport(event)">
                    <div style="display:flex; gap:10px;">
                        <div style="flex:1;"><label class="danger-label">First Name *</label><input type="text" class="danger-input" required></div>
                        <div style="flex:1;"><label class="danger-label">Last Name</label><input type="text" class="danger-input"></div>
                    </div>
                    <div style="display:flex; gap:10px;">
                        <div style="flex:1;"><label class="danger-label">Email ID *</label><input type="email" class="danger-input" required></div>
                        <div style="flex:1;"><label class="danger-label">Mobile</label><input type="tel" class="danger-input"></div>
                    </div>
                    <label class="danger-label">Location Coordinates *</label>
                    <input type="text" id="incident-loc-text" class="danger-input" placeholder="Click map..." readonly required>
                    <label class="danger-label">Hazard Type</label>
                    <select class="danger-input" required>
                        <option value="">Select Incident...</option>
                        <option value="accident">Major Accident</option>
                        <option value="smog">Zero Visibility Smog</option>
                        <option value="fire">Toxic Fire</option>
                    </select>
                    <div style="display:flex; gap:10px; align-items:center; margin-bottom:10px;">
                        <div id="captcha-display" style="background:#400; padding:10px; color:#fff; letter-spacing:3px; font-family:'Montserrat', sans-serif; border:1px dashed red;">ABCD</div>
                        <input type="text" id="captcha-input" class="danger-input" placeholder="Enter Code" style="margin:0;" required>
                    </div>
                    <button type="submit" class="submit-btn"><i class="fas fa-paper-plane"></i> TRANSMIT REPORT</button>
                </form>
            </div>
        </div>
    </div>

    <section id="home" class="active-section">
        <div id="location-box" class="location-badge">
            <i class="fas fa-satellite-dish"></i> Detecting Location...
        </div>

        <div class="aqi-wrapper">
            <svg class="aqi-svg">
                <circle class="aqi-circle-bg" cx="160" cy="160" r="140"></circle>
                <circle class="aqi-circle-progress" id="aqi-progress-bar" cx="160" cy="160" r="140"></circle>
            </svg>
            <div class="aqi-inner-content">
                <span class="aqi-number" id="main-aqi">--</span>
                <span class="aqi-label">AQI (PM 2.5)</span>
            </div>
        </div>
        
        <h3 id="aqi-text" style="color: var(--neon-red); letter-spacing: 2px; margin-bottom: 30px;">ANALYZING AIR...</h3>

        <div class="dashboard-grid">
            <div class="glass-card" id="composition">
                <h4 style="margin-bottom: 15px;"><i class="fas fa-chart-pie"></i> Pollutant Mix</h4>
                <div class="chart-container">
                    <canvas id="pollutantChart"></canvas>
                </div>
            </div>

            <div class="glass-card" id="causes">
                <h4 style="margin-bottom: 15px; color: var(--neon-yellow);"><i class="fas fa-exclamation-triangle"></i> Primary Causes</h4>
                
                <div class="causes-swap-container">
                    <div class="cause-list-wrapper">
                        <ul class="cause-list">
                            <li><i class="fas fa-car-side"></i> <strong>Vehicular Emissions</strong> (41%)</li>
                            <li><i class="fas fa-trowel-bricks"></i> <strong>Construction Dust</strong> (21%)</li>
                            <li><i class="fas fa-industry"></i> <strong>Industrial Waste</strong> (18%)</li>
                            <li><i class="fas fa-fire"></i> <strong>Farm Fires</strong> (Stubble) (15%)</li>
                        </ul>
                    </div>
                    
                    <div class="causes-chart-wrapper">
                        <canvas id="causesChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="glass-card" id="precautions">
                <h4 style="margin-bottom: 15px; color: var(--neon-green);"><i class="fas fa-shield-virus"></i> Safety Protocol</h4>
                <ul class="cause-list">
                    <li><i class="fas fa-mask"></i> Wear <strong>N95 Masks</strong> outdoors</li>
                    <li><i class="fas fa-window-close"></i> Keep windows closed post 5 PM</li>
                    <li><i class="fas fa-running"></i> Avoid outdoor cardio</li>
                    <li><i class="fas fa-leaf"></i> Use HEPA Air Purifiers</li>
                </ul>
            </div>
        </div>
    </section>

    <section id="maps">
        <h2>Live Air Quality Zones</h2>
        <div class="external-map-container">
            <iframe 
                src="https://www.aqi.in/in/air-quality-map?map_type=aqi&loc_slug=india" 
                style="border:none; width:100%; height:calc(100% + 160px); margin-top: -160px;"
                title="AQI India Map">
            </iframe>
        </div>
    </section>

    <section id="rules">
        <h2>GRAP Protocols</h2>
        <div class="stat-bar">
            <div>
                <span style="color: var(--text-muted); font-size: 0.8rem; font-family:'Montserrat',sans-serif; font-weight:700;">CURRENT STAGE</span><br>
                <strong style="color: var(--neon-red); font-size: 1.2rem; font-family:'Montserrat',sans-serif;">STAGE III (SEVERE)</strong>
            </div>
            <div style="text-align: right;">
                <span style="color: var(--text-muted); font-size: 0.8rem; font-family:'Montserrat',sans-serif; font-weight:700;">ACTIVE FINES</span><br>
                <strong style="color: #fff; font-size: 1.2rem; font-family:'Montserrat',sans-serif;">INR 20,000+</strong>
            </div>
        </div>

        <div class="grap-list">
            <div class="grap-item" onclick="toggleGrap(this)">
                <div class="grap-header">
                    <span><i class="fas fa-ban"></i> Vehicle Bans (BS-III/BS-IV)</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="grap-content">
                    Restriction on plying of BS-III Petrol and BS-IV Diesel LMVs (4-wheelers) in Delhi-NCR. 
                    <br><br><strong style="color:var(--neon-red)">Fine: INR 20,000 (Motor Vehicles Act)</strong>
                </div>
            </div>

            <div class="grap-item" onclick="toggleGrap(this)">
                <div class="grap-header">
                    <span><i class="fas fa-hard-hat"></i> Construction Halts</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="grap-content">
                    Strict ban on construction and demolition activities. Includes boring, drilling, and excavation.
                    <br><br><strong style="color:var(--neon-yellow)">Exemptions: Metro, Railway, Defense projects.</strong>
                </div>
            </div>

            <div class="grap-item" onclick="toggleGrap(this)">
                <div class="grap-header">
                    <span><i class="fas fa-smog"></i> Industrial Restrictions</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="grap-content">
                    Industries not running on cleaner fuels (PNG) must close operations immediately until further notice.
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button class="action-btn" onclick="alert('Redirecting to CPCB Official Guidelines PDF...')">Download Full Guidelines PDF</button>
            </div>
        </div>
    </section>

    <section id="ev">
        <h2>EV Charging Grid</h2>
        <p style="margin-bottom: 20px; color: var(--text-muted);">Live Network Status & Real-Time Availability</p>
        
        <div class="ev-dashboard">
            <div class="ev-stat-card">
                <i class="fas fa-charging-station" style="font-size: 2rem; color: var(--neon-blue);"></i>
                <h3>142</h3>
                <p>Active Hubs</p>
            </div>
            <div class="ev-stat-card">
                <i class="fas fa-plug" style="font-size: 2rem; color: var(--neon-green);"></i>
                <h3>56</h3>
                <p>Available Ports</p>
            </div>
            <div class="ev-stat-card">
                <i class="fas fa-leaf" style="font-size: 2rem; color: var(--neon-yellow);"></i>
                <h3>1.2k</h3>
                <p>Tons CO₂ Saved</p>
            </div>
        </div>

        <div class="btn-group">
            <button class="action-btn active" style="margin: 0 auto; display: block;"><i class="fas fa-bolt"></i> Displaying All Fast Chargers</button>
        </div>

        <div class="ev-main-container" style="margin-top: 20px;">
            <div id="ev-map" class="ev-map-enhanced"></div>
            
            <div class="ev-sidebar">
                <h4 style="font-family:'Montserrat', sans-serif; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom:10px; margin-bottom:15px; color:#fff;">
                    <i class="fas fa-list-ul"></i> Nearby Stations
                </h4>
                <div id="ev-list">
                    </div>
            </div>
        </div>
    </section>

    <section id="awareness">
        <h2>Awareness & Insights</h2>
        <div class="dashboard-grid">
            <div class="glass-card" id="topography-sim" style="grid-column: 1 / -1;">
                <h4 style="margin-bottom: 15px;"><i class="fas fa-mountain"></i> Delhi Topography & Pollution Simulation</h4>
                <div class="btn-group">
                    <button class="action-btn season-btn" onclick="setSeason('winter')">Winter Smog</button>
                    <button class="action-btn season-btn" onclick="setSeason('summer')">Summer Dispersal</button>
                </div>
                <div style="position: relative;">
                    <canvas id="simulation-canvas"></canvas>
                    <div id="sim-tooltip" class="tooltip"></div>
                </div>
                
                <h4 style="margin-top: 30px; margin-bottom: 15px;"><i class="fas fa-info-circle"></i> Simulation Legend & Meaning</h4>
                <div class="dashboard-grid" style="margin-top: 15px;">
                    <div class="glass-card">
                        <div style="display:flex; align-items:center; gap:10px;">
                            <i class="fas fa-mountain" style="color:#333; font-size:1.5rem;"></i>
                            <h5 style="margin:0; font-family:'Montserrat', sans-serif; font-size: 1.1rem;">Bowl-Shaped Terrain</h5>
                        </div>
                        <p style="margin-top:10px; color:#ccc; font-size: 0.9rem;">Delhi acts like a basin trapping pollutants and cold air close to the ground due to its geographical features.</p>
                    </div>
                    <div class="glass-card">
                        <div style="display:flex; align-items:center; gap:10px;">
                            <i class="fas fa-layer-group" style="color:var(--neon-blue); font-size:1.5rem;"></i>
                            <h5 style="margin:0; font-family:'Montserrat', sans-serif; font-size: 1.1rem;">Inversion Layer</h5>
                        </div>
                        <p style="margin-top:10px; color:#ccc; font-size: 0.9rem;">Warm air traps cold polluted air below, preventing pollutants from rising and dispersing, especially in winter.</p>
                    </div>
                    <div class="glass-card">
                        <div style="display:flex; align-items:center; gap:10px;">
                            <i class="fas fa-exclamation-circle" style="color:var(--danger-red); font-size:1.5rem;"></i>
                            <h5 style="margin:0; font-family:'Montserrat', sans-serif; font-size: 1.1rem;">Pollution Hotspots</h5>
                        </div>
                        <p style="margin-top:10px; color:#ccc; font-size: 0.9rem;">Represent areas of high emissions from traffic, industry, and construction where pollutants accumulate rapidly.</p>
                    </div>
                    <div class="glass-card">
                        <div style="display:flex; align-items:center; gap:10px;">
                            <i class="fas fa-wind" style="color:var(--neon-green); font-size:1.5rem;"></i>
                            <h5 style="margin:0; font-family:'Montserrat', sans-serif; font-size: 1.1rem;">Wind Arrows</h5>
                        </div>
                        <p style="margin-top:10px; color:#ccc; font-size: 0.9rem;">Show weak winds in winter failing to disperse pollutants versus stronger winds in summer aiding dispersal.</p>
                    </div>
                    <div class="glass-card">
                        <div style="display:flex; align-items:center; gap:10px;">
                            <i class="fas fa-smog" style="color:var(--danger-red); font-size:1.5rem;"></i>
                            <h5 style="margin:0; font-family:'Montserrat', sans-serif; font-size: 1.1rem;">Floating Particles</h5>
                        </div>
                        <p style="margin-top:10px; color:#ccc; font-size: 0.9rem;">Illustrate PM2.5/PM10 behavior; they float slowly and get trapped under inversion layers in winter.</p>
                    </div>
                    <div class="glass-card">
                        <div style="display:flex; align-items:center; gap:10px;">
                            <i class="fas fa-cloud" style="color:#808080; font-size:1.5rem;"></i>
                            <h5 style="margin:0; font-family:'Montserrat', sans-serif; font-size: 1.1rem;">Grey Overlay</h5>
                        </div>
                        <p style="margin-top:10px; color:#ccc; font-size: 0.9rem;">Depicts winter smog density, increasing pollutant concentration and reducing visibility across Delhi.</p>
                    </div>
                </div>
            </div>

            <div class="glass-card" id="timeline-quiz" style="grid-column: 1 / -1;">
                <h4 style="margin-bottom: 15px;"><i class="fas fa-history"></i> Pollution Timeline</h4>
                <div class="timeline">
                    <div class="timeline-event" style="border-left: 4px solid var(--neon-yellow);"><span>April 2025</span><p>Construction Dust Rise</p><p style="color:var(--neon-yellow)">AQI Increase: +20%</p><p>Post-winter construction activities kick off, raising dust levels across the city.</p></div>
                    <div class="timeline-event" style="border-left: 4px solid var(--neon-yellow);"><span>May 2025</span><p>Heat Waves & Dust</p><p style="color:var(--neon-yellow)">AQI Increase: +15%</p><p>Intense heat and dust storms from Rajasthan worsen air quality.</p></div>
                    <div class="timeline-event" style="border-left: 4px solid var(--neon-blue);"><span>June 2025</span><p>Pre-Monsoon Winds</p><p style="color:var(--neon-blue)">AQI Decrease: -10%</p><p>Winds before monsoon help disperse some accumulated pollutants.</p></div>
                    <div class="timeline-event" style="border-left: 4px solid var(--neon-green);"><span>July 2025</span><p>Monsoon Cleansing</p><p style="color:var(--neon-green)">AQI Decrease: -30%</p><p>Heavy rains wash away pollutants, significantly improving AQI.</p></div>
                    <div class="timeline-event" style="border-left: 4px solid var(--neon-blue);"><span>August 2025</span><p>Rainfall Improvement</p><p style="color:var(--neon-blue)">AQI Decrease: -25%</p><p>Ongoing monsoon reduces emissions and cleans the air further.</p></div>
                    <div class="timeline-event" style="border-left: 4px solid var(--neon-yellow);"><span>September 2025</span><p>Gradual Increase</p><p style="color:var(--neon-yellow)">AQI Increase: +10%</p><p>Post-monsoon, pollution starts building up with reduced rainfall.</p></div>
                    <div class="timeline-event" style="border-left: 4px solid var(--danger-red);"><span>October 2025</span><p>Diwali Spike</p><p style="color:var(--danger-red)">AQI Increase: +30%</p><p>Fireworks during Diwali cause a sharp rise in particulate matter.</p></div>
                    <div class="timeline-event" style="border-left: 4px solid var(--danger-red);"><span>November 2025</span><p>Stubble Burning Peak</p><p style="color:var(--danger-red)">AQI Increase: +50%</p><p>Farm fires in neighboring states blanket Delhi in smoke.</p></div>
                    <div class="timeline-event" style="border-left: 4px solid var(--danger-red);"><span>December 2025</span><p>Temperature Inversion</p><p style="color:var(--danger-red)">AQI Increase: +40%</p><p>Cold weather traps pollutants under inversion layers.</p></div>
                    <div class="timeline-event" style="min-width: 50px; border-left: 4px solid var(--neon-yellow); color: var(--neon-yellow); padding: 10px 0; justify-content:center;"><span>2026</span></div>
                    <div class="timeline-event" style="border-left: 4px solid var(--neon-blue);"><span>January 2026</span><p>GRAP Stage III/IV</p><p style="color:var(--neon-blue)">AQI Decrease: -20%</p><p>Strict GRAP measures enforced to curb emissions and improve air quality.</p></div>
                    <div class="timeline-event" style="border-left: 4px solid var(--neon-blue);"><span>February 2026</span><p>Western Disturbance</p><p style="color:var(--neon-blue)">AQI Decrease: -15%</p><p>Rainfall from western disturbances helps clear the air temporarily.</p></div>
                    <div class="timeline-event" style="border-left: 4px solid var(--neon-green);"><span>March 2026</span><p>Spring Dispersal</p><p style="color:var(--neon-green)">AQI Decrease: -40%</p><p>Warmer winds disperse remaining pollutants effectively as spring arrives.</p></div>
                </div>
                <div class="timeline-progress"><div class="progress-bar"></div></div>
                
                <hr style="border: 0; border-top: 1px solid rgba(255,255,255,0.1); margin: 30px 0;">
                
                <h4 style="margin-bottom: 20px;"><i class="fas fa-question-circle"></i> Awareness Knowledge Check</h4>
                <form id="quiz-form">
                    <div class="quiz-question">
                        <p>1. What is the primary contributor to pollution in Delhi according to the data?</p>
                        <label class="quiz-option"><input type="radio" name="q1" value="a"> a) Vehicular Emissions</label>
                        <label class="quiz-option"><input type="radio" name="q1" value="b"> b) Rainfall & Humidity</label>
                        <label class="quiz-option"><input type="radio" name="q1" value="c"> c) Natural Deforestation</label>
                    </div>
                    <div class="quiz-question">
                        <p>2. Why does pollution become severely trapped during winter months?</p>
                        <label class="quiz-option"><input type="radio" name="q2" value="a"> a) Temperature Inversion</label>
                        <label class="quiz-option"><input type="radio" name="q2" value="b"> b) Strong Dispersal Winds</label>
                        <label class="quiz-option"><input type="radio" name="q2" value="c"> c) Summer Heat Waves</label>
                    </div>
                    <div class="quiz-question">
                        <p>3. What is the primary health risk associated with high PM2.5 levels?</p>
                        <label class="quiz-option"><input type="radio" name="q3" value="a"> a) Respiratory & Lung Damage</label>
                        <label class="quiz-option"><input type="radio" name="q3" value="b"> b) Improved Visual Acuity</label>
                        <label class="quiz-option"><input type="radio" name="q3" value="c"> c) Increased Bone Density</label>
                    </div>
                    <button type="button" class="action-btn" onclick="submitQuiz()">Submit Answers</button>
                </form>
                <div id="quiz-feedback"></div>
            </div>
        </div>
    </section>

    <script>
        // Global variables
        let evMap = null;
        let evMarkers = []; // Array to store map markers for sidebar sync
        let reportMap = null;
        let generatedCaptcha = "";
        let season = 'winter';
        let particles = [];
        
    
const GEMINI_KEY = "AIzaSyBKZ9ZejCG1b59ylvXyuXAlVJqITtAPt7g"; // Replace this with your free key from Google AI Studio
const GEMINI_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${GEMINI_KEY}`;
        function init() {
            getLocation();
            initCharts();
            initEvMap();
            generateCaptcha(); 
            initSimulation();
            initTimelineProgress();
            initSeamlessVideo(); // Starts the dual-video crossfade
        }

        // --- SEAMLESS VIDEO CROSSFADE SCRIPT ---
        function initSeamlessVideo() {
            const v1 = document.getElementById('bg-video-1');
            const v2 = document.getElementById('bg-video-2');
            let activeVideo = 1;
            const fadeTime = 2.0; // Seconds to crossfade before end

            // Ensure first video plays
            v1.play().catch(e => console.log("Video autoplay blocked by browser:", e));
            
            v1.addEventListener('timeupdate', () => {
                if (activeVideo === 1 && v1.duration - v1.currentTime <= fadeTime) {
                    activeVideo = 2;
                    v2.currentTime = 0;
                    v2.play();
                    v2.style.opacity = 1;
                    v1.style.opacity = 0;
                }
            });

            v2.addEventListener('timeupdate', () => {
                if (activeVideo === 2 && v2.duration - v2.currentTime <= fadeTime) {
                    activeVideo = 1;
                    v1.currentTime = 0;
                    v1.play();
                    v1.style.opacity = 1;
                    v2.style.opacity = 0;
                }
            });
        }

        function switchTab(tabId) {
            document.querySelectorAll('nav a').forEach(a => a.classList.remove('active'));
            document.querySelectorAll('section').forEach(s => s.classList.remove('active-section'));
            document.getElementById('nav-' + tabId).classList.add('active');
            
            const targetSection = document.getElementById(tabId);
            targetSection.classList.add('active-section');

            if (tabId === 'ev' && evMap) {
                setTimeout(() => { evMap.invalidateSize(); }, 100);
            }
        }

        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(pos => {
                    const lat = pos.coords.latitude.toFixed(4);
                    const lon = pos.coords.longitude.toFixed(4);
                    document.getElementById('location-box').innerHTML = `<i class="fas fa-map-marker-alt"></i> ${lat}, ${lon} (Delhi NCR)`;
                    setTimeout(() => { updateDashboard(342, "HAZARDOUS"); }, 1000);
                }, () => {
                    document.getElementById('location-box').innerHTML = `<i class="fas fa-map-marker-alt"></i> Location Denied. Showing Delhi Default.`;
                    updateDashboard(342, "HAZARDOUS");
                });
            }
        }

        function getAqiColor(aqi) {
            if (aqi <= 100) return '#00ff9d'; 
            if (aqi <= 200) return '#f1c40f'; 
            if (aqi <= 300) return '#ff9f43'; 
            return '#ff0000'; 
        }

        function updateDashboard(aqi, status) {
            let current = 0;
            const aqiColor = getAqiColor(aqi);
            
            document.getElementById('aqi-text').innerText = status;
            document.getElementById('aqi-text').style.color = aqiColor;

            const counter = setInterval(() => {
                current += 5;
                document.getElementById('main-aqi').innerText = current;
                if(current >= aqi) {
                    clearInterval(counter);
                    document.getElementById('main-aqi').innerText = aqi;
                }
            }, 10);

            const circle = document.getElementById('aqi-progress-bar');
            const circumference = 2 * Math.PI * 140; 
            const maxAqi = 500; 
            const offset = circumference - ((aqi / maxAqi) * circumference);
            
            circle.style.stroke = aqiColor;
            circle.style.filter = `drop-shadow(0 0 15px ${aqiColor})`;
            circle.style.strokeDashoffset = offset;
        }

        function initCharts() {
            const ctx = document.getElementById('pollutantChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['PM 2.5', 'PM 10', 'NO2', 'CO'],
                    datasets: [{
                        data: [45, 30, 15, 10],
                        backgroundColor: ['#ff0000', '#f1c40f', '#00d2ff', '#00ff9d'],
                        borderColor: '#050505',
                        borderWidth: 4,
                        hoverOffset: 10
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false, cutout: '75%',
                    plugins: {
                        legend: { position: 'bottom', labels: { color: '#ccc', font: { family: 'Open Sans', size: 12 }, padding: 20, usePointStyle: true } },
                        tooltip: { backgroundColor: 'rgba(20, 20, 20, 0.9)', titleFont: { family: 'Montserrat' }, bodyFont: { family: 'Open Sans' }, padding: 12, borderColor: 'rgba(255,255,255,0.1)', borderWidth: 1 }
                    },
                    animation: { animateScale: true, animateRotate: true }
                }
            });

            const ctxCauses = document.getElementById('causesChart').getContext('2d');
            new Chart(ctxCauses, {
                type: 'bar',
                data: {
                    labels: ['Vehicular', 'Construction', 'Industrial', 'Farm Fires'],
                    datasets: [{
                        label: 'Impact (%)',
                        data: [41, 21, 18, 15],
                        backgroundColor: [
                            'rgba(0, 210, 255, 0.8)',   
                            'rgba(241, 196, 15, 0.8)',  
                            'rgba(255, 159, 67, 0.8)',  
                            'rgba(255, 0, 60, 0.8)'     
                        ],
                        borderWidth: 0,
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: 'rgba(255, 255, 255, 0.05)' },
                            ticks: { color: '#888', font: { family: 'Open Sans' } }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { color: '#888', font: { family: 'Open Sans' } }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(20, 20, 20, 0.9)',
                            titleFont: { family: 'Montserrat' },
                            bodyFont: { family: 'Open Sans' },
                            padding: 12,
                            borderColor: 'rgba(255,255,255,0.1)',
                            borderWidth: 1
                        }
                    }
                }
            });
        }

        function toggleGrap(element) {
            const content = element.querySelector('.grap-content');
            const icon = element.querySelector('.fa-chevron-down');
            if (content.style.display === "block") {
                content.style.display = "none";
                icon.style.transform = "rotate(0deg)";
            } else {
                content.style.display = "block";
                icon.style.transform = "rotate(180deg)";
            }
        }

        /* --- REDESIGNED EV MAP LOGIC (Emails & Phone Numbers Added) --- */
        function initEvMap() {
            evMap = L.map('ev-map').setView([28.6139, 77.2090], 11);
            L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', { attribution: 'Tiles | Esri' }).addTo(evMap);

            const evIcon = L.divIcon({
                className: 'custom-div-icon',
                html: "<div style='background-color:var(--neon-green); width:20px; height:20px; border-radius:50%; box-shadow:0 0 15px var(--neon-green); border: 2px solid white;'></div>",
                iconSize: [20, 20], iconAnchor: [10, 10]
            });

            // Expanded data array with unique phone numbers and real-world style emails
            const stations = [
                { lat: 28.5355, lng: 77.2694, name: "Tata Power Charging", address: "Okhla Industrial Estate Phase 2", state: "Delhi", status: "Available", phone: "+91 98765 43210", email: "support@tatapower.com" },
                { lat: 28.6983, lng: 77.1415, name: "BluSmart Hub", address: "Kohat Enclave Parking Area", state: "Delhi", status: "Available", phone: "+91 98765 43211", email: "care@blusmart.com" },
                { lat: 28.5715, lng: 77.2370, name: "Powerbank Charging", address: "Lajpat Nagar II, Central Market", state: "Delhi", status: "Available", phone: "+91 98765 43212", email: "contact@powerbank.com" },
                { lat: 28.6304, lng: 77.2177, name: "EESL Fast Hub", address: "Connaught Place, Middle Circle", state: "Delhi", status: "In Use (Wait: 15m)", phone: "+91 98765 43213", email: "evsupport@eesl.co.in" },
                { lat: 28.5700, lng: 77.3200, name: "Charge+Zone", address: "Sector 18 Commercial Market", state: "Uttar Pradesh", status: "Available", phone: "+91 98765 43214", email: "help@chargezone.com" },
                { lat: 28.6994, lng: 77.2041, name: "Reliance BP Mobility", address: "GTB Nagar Metro Parking", state: "Delhi", status: "Available", phone: "+91 98765 43215", email: "support@jiobp.com" },
                { lat: 28.6758, lng: 77.3124, name: "Sun Mobility", address: "Jhilmil Industrial Area Phase 1", state: "Delhi", status: "Maintenance Offline", phone: "+91 98765 43216", email: "hello@sunmobility.com" },
                { lat: 28.6175, lng: 77.2792, name: "Powerbank Charging", address: "Pandav Nagar, NH-24", state: "Delhi", status: "Available", phone: "+91 98765 43217", email: "contact@powerbank.com" },
                { lat: 28.4800, lng: 77.1255, name: "Shuchi Anant Virya", address: "Arjangarh Parking Hub", state: "Delhi", status: "Available", phone: "+91 98765 43218", email: "support@shuchiev.com" },
                { lat: 28.4595, lng: 77.0266, name: "Ather Grid", address: "Galleria Market, Sector 28", state: "Haryana", status: "Available", phone: "+91 98765 43219", email: "info@atherenergy.com" }
            ];

            let sidebarHTML = '';

            stations.forEach((st, index) => {
                // Nearest EV calculation
                let nearestStationName = "None";
                let minDistance = Infinity;
                stations.forEach(otherSt => {
                    if (otherSt.name !== st.name) {
                        const dist = Math.sqrt(Math.pow(st.lat - otherSt.lat, 2) + Math.pow(st.lng - otherSt.lng, 2));
                        if (dist < minDistance) {
                            minDistance = dist;
                            nearestStationName = otherSt.name;
                        }
                    }
                });

                let isAvailable = st.status.includes('Available');
                let statusColor = isAvailable ? 'var(--neon-green)' : (st.status.includes('Use') ? 'var(--neon-yellow)' : 'var(--danger-red)');
                let statusClass = isAvailable ? 'status-avail' : (st.status.includes('Use') ? 'status-busy' : 'status-down');
                
                let popupGlow = isAvailable ? 'box-shadow: 0 0 15px rgba(0, 255, 157, 0.3); text-shadow: 0 0 10px rgba(0, 255, 157, 0.7);' : '';
                
                let sidebarStatusText = isAvailable 
                    ? `<span style="color: var(--neon-green); font-weight: 800; text-shadow: 0 0 8px rgba(0,255,157,0.6);">${st.status}</span>` 
                    : `<span style="color: #aaa;">${st.status}</span>`;

                // Map Popup with Email & Phone buttons
                let popupContent = `
                    <div style="font-family: 'Montserrat', sans-serif; color: #111; min-width: 240px;">
                        <h4 style="margin: 0 0 8px 0; font-weight: 800; font-size: 1.1rem; border-bottom: 2px solid var(--neon-blue); padding-bottom: 5px;">${st.name}</h4>
                        
                        <p style="margin: 5px 0; font-family: 'Open Sans', sans-serif; font-size: 0.9rem;">
                            <i class="fas fa-map-marker-alt" style="color:var(--danger-red); width:15px;"></i> <strong>Location:</strong> ${st.address}
                        </p>
                        <p style="margin: 5px 0; font-family: 'Open Sans', sans-serif; font-size: 0.9rem;">
                            <i class="fas fa-phone-alt" style="color:var(--neon-blue); width:15px;"></i> <strong>Contact:</strong> <span style="font-weight: 700; color: #333;">${st.phone}</span>
                        </p>
                        <p style="margin: 5px 0; font-family: 'Open Sans', sans-serif; font-size: 0.9rem;">
                            <i class="fas fa-charging-station" style="color:#00d2ff; width:15px;"></i> <strong>Nearest EV:</strong> ${nearestStationName}
                        </p>
                        
                        <div style="margin-top: 12px; padding: 6px; background: rgba(0,0,0,0.9); border-radius: 5px; text-align: center; color: ${statusColor}; font-weight: 800; font-size: 0.95rem; border: 1px solid ${statusColor}; ${popupGlow}">
                            <i class="fas fa-bolt"></i> Status: ${st.status}
                        </div>
                        
                        <div style="display: flex; gap: 8px; margin-top: 12px;">
                            <button onclick="window.open('https://maps.google.com/?q=${st.lat},${st.lng}', '_blank')" style="flex: 1; padding: 10px; background: var(--neon-blue); border: none; border-radius: 20px; color: #000; font-family: 'Montserrat', sans-serif; font-weight: 700; cursor: pointer; transition: 0.3s; box-shadow: 0 4px 15px rgba(0,210,255,0.3); font-size: 0.8rem;">
                                <i class="fas fa-directions"></i> Route
                            </button>
                            <button onclick="window.location.href='mailto:${st.email}?subject=EV Charging Enquiry - ${st.name}'" style="flex: 1; padding: 10px; background: transparent; border: 2px solid var(--neon-blue); border-radius: 20px; color: #111; font-family: 'Montserrat', sans-serif; font-weight: 700; cursor: pointer; transition: 0.3s; font-size: 0.8rem;">
                                <i class="fas fa-envelope"></i> Email
                            </button>
                        </div>
                    </div>
                `;
                
                const marker = L.marker([st.lat, st.lng], { icon: evIcon }).addTo(evMap).bindPopup(popupContent);
                evMarkers.push(marker);

                // Sidebar updated with phone icon and active glowing indicator
                sidebarHTML += `
                    <div class="ev-list-item" onclick="focusEvMarker(${index})">
                        <h5>${st.name}</h5>
                        <p style="margin-bottom: 5px; color:#ccc;"><i class="fas fa-map-marker-alt" style="width: 15px; color: var(--danger-red);"></i> ${st.address}</p>
                        <p style="margin-bottom: 8px; color:#ccc;"><i class="fas fa-phone-alt" style="width: 15px; color: var(--neon-blue);"></i> ${st.phone}</p>
                        <p style="display:flex; align-items:center;"><span class="ev-status-dot ${statusClass}"></span> ${sidebarStatusText}</p>
                    </div>
                `;
            });

            document.getElementById('ev-list').innerHTML = sidebarHTML;
        }

        function focusEvMarker(index) {
            const marker = evMarkers[index];
            if (marker) {
                evMap.flyTo(marker.getLatLng(), 15, { animate: true, duration: 1.5 });
                setTimeout(() => { marker.openPopup(); }, 1500); 
            }
        }

        // --- CHATBOT JS ---
        function toggleChatPanel() {
            const panel = document.getElementById('chatPanel');
            if (panel.style.display === 'block') {
                panel.style.display = 'none';
            } else {
                panel.style.display = 'block';
                document.getElementById('chatInput').focus();
            }
        }

        function handleChatEnter(event) {
            if(event.key === 'Enter') {
                sendChatMsg();
            }
        }

        async function sendChatMsg() {
    const input = document.getElementById('chatInput');
    const windowObj = document.getElementById('chatWindow');
    const msgText = input.value.trim();
    if(msgText === "") return;
    
    // Add user message to chat
    windowObj.innerHTML += `<div class="msg msg-user">${msgText}</div>`;
    input.value = "";
    windowObj.scrollTop = windowObj.scrollHeight;
    
    // Add typing indicator
    const typingId = "bot-typing-" + Date.now();
    windowObj.innerHTML += `<div class="msg msg-bot" id="${typingId}">
        <i class="fas fa-spinner fa-spin"></i> Analyzing atmosphere...
    </div>`;
    windowObj.scrollTop = windowObj.scrollHeight;

    try {
        const systemPrompt = "You are Vayuxa, an expert AI guardian for Delhi's Air Quality. Your mission is to strictly answer questions related to pollution, AQI, EV vehicles, health precautions (like N95 masks), GRAP (Graded Response Action Plan), and climate change. If the user asks a question UNRELATED to these topics, politely refuse to answer and guide them back to discussing air quality. Current Delhi Context: AQI is 342 (Hazardous). GRAP Stage III is active. Be concise, urgent, and helpful.";

        // Call Gemini API
        const response = await fetch(GEMINI_URL, {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                "systemInstruction": {
                    "parts": [{"text": systemPrompt}]
                },
                "contents": [{
                    "parts": [{"text": msgText}]
                }],
                "generationConfig": {
                    "temperature": 0.3
                }
            })
        });

        const data = await response.json();
        
        if (response.ok && data.candidates && data.candidates.length > 0) {
            let replyText = data.candidates[0].content.parts[0].text;
            
            // Convert Gemini's markdown line breaks into HTML line breaks
            replyText = replyText.replace(/\n/g, "<br>");
            
            // Format bold text (from **text** to <strong>text</strong>)
            replyText = replyText.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');

            document.getElementById(typingId).innerHTML = replyText;
        } else {
            // Handle API errors
            if (data.error) {
                document.getElementById(typingId).innerText = `Error: ${data.error.message}`;
            } else {
                document.getElementById(typingId).innerText = "System malfunction. Unable to process data.";
            }
            console.error("Gemini API Error details:", data);
        }
    } catch (error) {
        document.getElementById(typingId).innerText = "Network Error. Connection intercepted. Are you connected to the internet?";
        console.error("Fetch Error:", error);
    }
    
    windowObj.scrollTop = windowObj.scrollHeight;
}

        // --- REPORT MODAL LOGIC ---
        function openReportModal() {
            document.getElementById('report-modal').style.display = 'flex';
            if (!reportMap) setTimeout(initReportMap, 100); else setTimeout(() => reportMap.invalidateSize(), 100);
        }

        function closeReportModal() { document.getElementById('report-modal').style.display = 'none'; }

        function initReportMap() {
            reportMap = L.map('report-map').setView([28.61, 77.23], 12);
            L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', { attribution: 'Esri' }).addTo(reportMap);
            
            reportMap.on('click', function(e) {
                reportMap.eachLayer(l => { if(l instanceof L.Marker) reportMap.removeLayer(l); });
                const redIcon = L.divIcon({ html: '<i class="fas fa-radiation-alt" style="color:#ff003c; font-size:30px; text-shadow:0 0 10px black;"></i>', className: 'marker', iconSize: [30, 30], iconAnchor: [15, 15] });
                L.marker(e.latlng, {icon: redIcon}).addTo(reportMap);
                document.getElementById('incident-loc-text').value = `${e.latlng.lat.toFixed(5)}, ${e.latlng.lng.toFixed(5)}`;
            });
        }

        function traceIncidentPath() {
            if(!reportMap) return;
            const userLoc = [28.627, 77.215]; 
            const center = reportMap.getCenter();
            L.polyline([userLoc, center], { color: '#ff003c', weight: 4, dashArray: '10, 10', opacity: 0.8 }).addTo(reportMap);
            reportMap.fitBounds(L.latLngBounds([userLoc, center]), {padding:[20,20]});
        }

        function generateCaptcha() {
            const chars = "ABCDEF1234567890";
            let code = "";
            for(let i=0; i<4; i++) code += chars[Math.floor(Math.random()*chars.length)];
            generatedCaptcha = code;
            document.getElementById('captcha-display').innerText = code;
        }

        function submitReport(e) {
            e.preventDefault();
            if(document.getElementById('captcha-input').value.toUpperCase() !== generatedCaptcha) { alert("Incorrect Captcha!"); return; }
            alert("EMERGENCY REPORT TRANSMITTED!");
            closeReportModal();
        }

        // --- BALLOON LOGIC ---
        const pollutionFacts = [
            "Air pollution causes approximately 7 million premature deaths globally every year.",
            "Breathing Delhi's air in winter can be as harmful as smoking up to 25 cigarettes a day.",
            "PM2.5 particles are small enough to enter the bloodstream and damage vital organs.",
            "Over 90% of the world's population lives in areas where air quality exceeds WHO limits.",
            "Switching to EVs could reduce urban vehicular emissions by up to 70% in high-traffic zones."
        ];

        function handleBalloonPop() {
            const balloon = document.getElementById('balloonBtn');
            const popup = document.getElementById('factPopup');
            const factText = document.getElementById('factText');

            balloon.style.display = 'none';
            factText.innerText = pollutionFacts[Math.floor(Math.random() * pollutionFacts.length)];
            popup.style.display = 'block';

            setTimeout(() => { closeFact(); balloon.style.display = 'flex'; }, 5000);
        }

        function closeFact() { document.getElementById('factPopup').style.display = 'none'; }
        
        // --- INSIGHTS/AWARENESS LOGIC ---
        function initSimulation() {
            const canvas = document.getElementById('simulation-canvas');
            const ctx = canvas.getContext('2d');
            const tooltip = document.getElementById('sim-tooltip');
            
            const resizeCanvas = () => {
                canvas.width = canvas.parentElement.clientWidth;
                canvas.height = 300;
            };
            window.addEventListener('resize', resizeCanvas);
            resizeCanvas();

            canvas.addEventListener('mousemove', (e) => {
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                if (x > 100 && x < canvas.width && y > 150 && y < canvas.height - 50) {
                    tooltip.style.display = 'block';
                    tooltip.innerText = 'Bowl-shaped terrain: Traps pollutants like a natural basin.';
                    tooltip.style.left = `${e.pageX + 10}px`;
                    tooltip.style.top = `${e.pageY}px`;
                } else if (x > 0 && x < canvas.width && y > 100 && y < 200) {
                    tooltip.style.display = 'block';
                    tooltip.innerText = 'Inversion Layer: Traps pollutants in winter by preventing vertical dispersal.';
                    tooltip.style.left = `${e.pageX + 10}px`;
                    tooltip.style.top = `${e.pageY}px`;
                } else if (x > 150 && x < 250 && y > canvas.height - 100 && y < canvas.height) {
                    tooltip.style.display = 'block';
                    tooltip.innerText = 'Pollution Hotspot: High emissions from vehicles and industries accumulate here.';
                    tooltip.style.left = `${e.pageX + 10}px`;
                    tooltip.style.top = `${e.pageY}px`;
                } else if (x > canvas.width - 200 && x < canvas.width - 100 && y > canvas.height - 100 && y < canvas.height) {
                    tooltip.style.display = 'block';
                    tooltip.innerText = 'Pollution Hotspot: Stubble burning and dust contribute to trapped air.';
                    tooltip.style.left = `${e.pageX + 10}px`;
                    tooltip.style.top = `${e.pageY}px`;
                } else if (x > 0 && x < 200 && y > 50 && y < 150) {
                    tooltip.style.display = 'block';
                    tooltip.innerText = 'Weak Winds: In winter, low wind speeds fail to disperse pollutants.';
                    tooltip.style.left = `${e.pageX + 10}px`;
                    tooltip.style.top = `${e.pageY}px`;
                } else {
                    tooltip.style.display = 'none';
                }
            });

            canvas.addEventListener('mouseout', () => tooltip.style.display = 'none');

            function draw() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                ctx.beginPath();
                ctx.moveTo(0, canvas.height - 100);
                ctx.quadraticCurveTo(canvas.width / 2, 50, canvas.width, canvas.height - 100);
                ctx.lineTo(canvas.width, canvas.height);
                ctx.lineTo(0, canvas.height);
                ctx.fillStyle = '#111';
                ctx.fill();
                
                ctx.beginPath();
                ctx.moveTo(0, 150);
                ctx.lineTo(canvas.width, 150);
                ctx.strokeStyle = '#00d2ff';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                ctx.fillStyle = '#ff003c';
                ctx.beginPath();
                ctx.arc(200, canvas.height - 50, 20, 0, Math.PI * 2);
                ctx.fill();
                ctx.beginPath();
                ctx.arc(canvas.width - 150, canvas.height - 50, 20, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.strokeStyle = '#00ff9d';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(50, 100);
                ctx.lineTo(150, 100);
                ctx.moveTo(150, 100);
                ctx.lineTo(140, 90);
                ctx.moveTo(150, 100);
                ctx.lineTo(140, 110);
                ctx.stroke();
                
                if (season === 'winter') {
                    ctx.fillStyle = 'rgba(128, 128, 128, 0.4)';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                }
                
                particles.forEach(p => {
                    ctx.fillStyle = 'rgba(255, 0, 60, 0.6)';
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                    ctx.fill();
                    p.y -= p.speed;
                    if (season === 'winter' && p.y < 150) p.speed = 0.1; 
                    if (p.y < 0) p.y = canvas.height;
                });
                requestAnimationFrame(draw);
            }
            
            for (let i = 0; i < 50; i++) {
                particles.push({
                    x: Math.random() * 2000, 
                    y: Math.random() * 300,
                    size: Math.random() * 5 + 1,
                    speed: season === 'winter' ? 0.5 : 2
                });
            }
            draw();
        }

        function setSeason(newSeason) {
            season = newSeason;
            particles.forEach(p => {
                p.speed = season === 'winter' ? 0.5 : 2;
            });
        }

        function submitQuiz() {
            const answers = { q1: 'a', q2: 'a', q3: 'a' };
            const facts = {
                q1: 'Vehicles contribute 41% to Delhi\'s pollution.',
                q2: 'Temperature inversion traps pollutants close to the ground in winter.',
                q3: 'High PM2.5 can cause serious respiratory and cardiovascular damage.'
            };
            
            let score = 0;
            let feedback = '';
            const form = document.getElementById('quiz-form');
            
            if(!form.q1.value || !form.q2.value || !form.q3.value) {
                alert("Please answer all questions before submitting.");
                return;
            }

            const q1 = form.q1.value;
            const q2 = form.q2.value;
            const q3 = form.q3.value;
            
            if (q1 === answers.q1) score++;
            if (q2 === answers.q2) score++;
            if (q3 === answers.q3) score++;
            
            feedback += `<strong>Final Score: ${score}/3</strong><br><br>`;
            if (q1 !== answers.q1) feedback += `<span style="color:var(--danger-red)">Q1: Incorrect.</span> Fact: ${facts.q1}<br>`;
            if (q2 !== answers.q2) feedback += `<span style="color:var(--danger-red)">Q2: Incorrect.</span> Fact: ${facts.q2}<br>`;
            if (q3 !== answers.q3) feedback += `<span style="color:var(--danger-red)">Q3: Incorrect.</span> Fact: ${facts.q3}<br>`;
            
            if(score === 3) feedback += "Perfect Score! You are highly aware of the environmental situation.";

            document.getElementById('quiz-feedback').innerHTML = feedback;
        }

        function initTimelineProgress() {
            const timeline = document.querySelector('.timeline');
            const progressBar = document.querySelector('.progress-bar');
            if (timeline && progressBar) {
                timeline.addEventListener('scroll', () => {
                    const scrollWidth = timeline.scrollWidth - timeline.clientWidth;
                    const scrollLeft = timeline.scrollLeft;
                    const progress = (scrollLeft / scrollWidth) * 100;
                    progressBar.style.width = `${progress}%`;
                });
            }
        }

        window.onload = init;
    </script>
</body>
</html>
