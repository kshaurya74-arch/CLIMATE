<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VayuVision | Climate Data Hackathon 2026</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;500;700&family=Outfit:wght@300;400;600&display=swap" rel="stylesheet">

    <style>
        /* --- CORE THEME --- */
        :root {
            --bg-dark: #050505;
            --card-bg: rgba(15, 15, 15, 0.65); /* Adjusted for new video visibility */
            --glass-border: rgba(255, 255, 255, 0.15);
            --neon-green: #00ff9d;
            --neon-red: #ff3fab;
            --neon-blue: #00d2ff;
            --neon-yellow: #f1c40f;
            --danger-red: #ff003c;
            --text-main: #ffffff;
            --text-muted: #e0e0e0;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Outfit', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-main);
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* --- VIDEO BACKGROUND --- */
        .video-bg-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -10;
            overflow: hidden;
        }

        #bg-video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            filter: brightness(0.6) contrast(1.1); /* Tweaked for the sunset video */
        }

        /* --- CLICK EFFECTS --- */
        .click-ripple {
            position: fixed;
            border: 2px solid var(--neon-blue);
            border-radius: 50%;
            width: 10px; height: 10px;
            transform: translate(-50%, -50%);
            pointer-events: none;
            z-index: 9999;
            box-shadow: 0 0 15px var(--neon-blue);
            animation: ripple-anim 0.6s linear forwards;
        }

        @keyframes ripple-anim {
            0% { width: 0; height: 0; opacity: 1; border-width: 5px; }
            100% { width: 150px; height: 150px; opacity: 0; border-width: 0px; }
        }

        /* --- NAVIGATION --- */
        nav {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 600px;
            background: rgba(20, 20, 20, 0.85); backdrop-filter: blur(15px);
            padding: 12px 25px; border-radius: 50px;
            border: 1px solid var(--glass-border); z-index: 1000;
            display: flex; justify-content: space-between;
            box-shadow: 0 10px 40px rgba(0,0,0,0.6);
        }

        nav a {
            color: var(--text-muted); text-decoration: none; font-size: 0.8rem;
            font-weight: 600; text-transform: uppercase; letter-spacing: 1px;
            transition: all 0.3s ease; display: flex; flex-direction: column; 
            align-items: center; gap: 4px; cursor: pointer;
        }
        nav a:hover, nav a.active { color: var(--neon-green); text-shadow: 0 0 12px rgba(0, 255, 157, 0.6); }

        /* --- SECTIONS --- */
        section {
            display: none; min-height: 100vh; padding: 110px 20px 40px 20px;
            flex-direction: column; align-items: center; max-width: 1200px;
            margin: 0 auto; animation: fadeIn 0.5s ease-in-out;
        }
        section.active-section { display: flex; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        h2 { 
            font-family: 'Space Grotesk', sans-serif; font-size: 2.5rem; margin-bottom: 30px; 
            color: #fff; text-shadow: 0 0 20px rgba(0,0,0,0.5);
            text-align: center; text-transform: uppercase; letter-spacing: 2px;
        }

        /* --- CARDS & UI --- */
        .glass-card {
            background: var(--card-bg); border: 1px solid var(--glass-border);
            border-radius: 24px; padding: 30px; backdrop-filter: blur(12px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4); width: 100%; margin-bottom: 20px;
            transition: transform 0.2s, border-color 0.3s;
        }
        .glass-card:hover { border-color: rgba(255,255,255,0.4); }

        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; width: 100%; margin-top: 20px; }

        .aqi-circle { 
            width: 220px; height: 220px; border-radius: 50%; 
            background: conic-gradient(var(--neon-red) 0% 70%, #333 70% 100%); 
            display: flex; justify-content: center; align-items: center; margin: 20px auto; 
            box-shadow: 0 0 50px rgba(255, 63, 171, 0.4); 
            animation: pulse-glow 3s infinite alternate;
        }
        @keyframes pulse-glow { from { box-shadow: 0 0 20px rgba(255, 63, 171, 0.2); } to { box-shadow: 0 0 60px rgba(255, 63, 171, 0.6); } }

        .aqi-inner { width: 200px; height: 200px; background: rgba(20,20,20,0.95); border-radius: 50%; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .aqi-number { font-size: 4.5rem; font-weight: 700; color: #fff; line-height: 1; }

        .chart-container { position: relative; height: 250px; width: 100%; }
        
        /* --- CLASSY MAP STYLES --- */
        .map-wrapper {
            width: 100%; height: 60vh; border-radius: 16px;
            border: 2px solid rgba(255,255,255,0.2);
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
            overflow: hidden;
            position: relative;
        }
        
        /* Specific map IDs */
        #ev-map, #route-map, #report-map { width: 100%; height: 100%; background: #222; }
        
        .external-map-container { 
            width: 100%; height: 75vh; border-radius: 24px; overflow: hidden; 
            background: #fff; position: relative; border: 2px solid rgba(255,255,255,0.2);
            box-shadow: 0 0 40px rgba(0,0,0,0.6);
        }
        .external-map-container iframe { width: 100%; height: 100%; border: none; }

        /* --- SOS BUTTON --- */
        .sos-fab {
            position: fixed; bottom: 30px; right: 30px; width: 70px; height: 70px;
            background: var(--danger-red); border-radius: 50%; display: flex; justify-content: center; align-items: center;
            box-shadow: 0 0 20px rgba(255, 0, 60, 0.5); z-index: 2000; cursor: pointer;
            animation: pulse-red 2s infinite; border: 3px solid white; transition: transform 0.1s;
        }
        .sos-fab i { color: white; font-size: 1.8rem; }
        @keyframes pulse-red {
            0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(255, 0, 60, 0.7); }
            70% { transform: scale(1); box-shadow: 0 0 0 20px rgba(255, 0, 60, 0); }
            100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(255, 0, 60, 0); }
        }

        /* --- MODAL --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.85); z-index: 3000; display: none;
            justify-content: center; align-items: center; padding: 20px; backdrop-filter: blur(10px);
        }
        .modal-content {
            background: linear-gradient(135deg, rgba(30,30,30,0.95), rgba(50,50,50,0.95));
            border: 2px solid var(--danger-red); width: 100%; max-width: 900px; max-height: 90vh;
            overflow-y: auto; border-radius: 30px; padding: 30px; position: relative;
            box-shadow: 0 0 60px rgba(255, 0, 60, 0.4); animation: slideUp 0.4s ease;
        }
        @keyframes slideUp { from { transform: translateY(100px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .close-modal {
            position: absolute; top: 20px; right: 25px; color: #fff; font-size: 1.5rem; cursor: pointer;
            background: rgba(255,255,255,0.1); width: 40px; height: 40px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; transition: 0.3s;
        }
        .close-modal:hover { background: var(--danger-red); }

        /* Report Form */
        .report-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-top: 20px; }
        @media(max-width: 768px) { .report-grid { grid-template-columns: 1fr; } }
        .danger-input { width: 100%; background: rgba(0, 0, 0, 0.4); border: 1px solid #777; color: #fff; padding: 12px; margin-bottom: 12px; border-radius: 8px; font-family: 'Space Grotesk'; }
        .danger-input:focus { border-color: var(--danger-red); outline: none; background: rgba(0,0,0,0.6); }
        .danger-label { color: var(--danger-red); font-size: 0.85rem; font-weight: bold; margin-bottom: 5px; display: block; letter-spacing: 1px;}
        .submit-btn { background: var(--danger-red); color: white; border: none; width: 100%; padding: 15px; font-weight: 700; border-radius: 30px; cursor: pointer; text-transform: uppercase; letter-spacing: 2px; transition: 0.3s; margin-top: 10px; }
        .submit-btn:hover { background: #ff3366; box-shadow: 0 0 25px var(--danger-red); }

        .cyber-input { width: 100%; background: rgba(0, 0, 0, 0.5); border: 1px solid var(--text-muted); padding: 12px 20px; border-radius: 30px; color: #fff; font-family: 'Space Grotesk'; outline: none; transition: 0.3s; margin-bottom: 15px; }
        .cyber-input:focus { border-color: var(--neon-green); box-shadow: 0 0 15px rgba(0, 255, 157, 0.3); background: rgba(0,0,0,0.7); }
        .action-btn { background: transparent; border: 1px solid var(--text-muted); color: var(--text-main); padding: 10px 24px; border-radius: 30px; cursor: pointer; font-family: 'Space Grotesk'; transition: 0.3s; font-weight: 600; }
        .action-btn:hover { border-color: var(--neon-blue); background: rgba(0, 210, 255, 0.15); color: var(--neon-blue); box-shadow: 0 0 15px rgba(0, 210, 255, 0.2); }

        /* GRAP LIST */
        .grap-list { width: 100%; max-width: 800px; display: flex; flex-direction: column; gap: 15px; }
        .grap-item { background: linear-gradient(90deg, rgba(30,30,30,0.9) 0%, rgba(30,30,30,0.6) 100%); border-left: 4px solid var(--neon-red); padding: 20px; cursor: pointer; border-radius: 12px; transition: 0.3s; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .grap-item:hover { background: rgba(255, 63, 171, 0.1); transform: translateX(5px); }
        .grap-content { display: none; margin-top: 15px; color: #ddd; font-size: 0.95rem; line-height: 1.6; }
        .grap-header { display: flex; justify-content: space-between; align-items: center; font-weight: 600; font-size: 1.1rem; }
    </style>
</head>
<body>

    <div class="video-bg-container">
        <video autoplay muted loop playsinline id="bg-video">
            <source src="88239-602915779_medium.mp4" type="video/mp4">
            Your browser does not support the video tag.
        </video>
    </div>

    <nav>
        <a onclick="switchTab('home')" id="nav-home" class="active"><i class="fas fa-home"></i> Home</a>
        <a onclick="switchTab('maps')" id="nav-maps"><i class="fas fa-map-marked-alt"></i> Zones</a>
        <a onclick="switchTab('routes')" id="nav-routes"><i class="fas fa-route"></i> Green Path</a>
        <a onclick="switchTab('rules')" id="nav-rules"><i class="fas fa-gavel"></i> GRAP</a>
        <a onclick="switchTab('ev')" id="nav-ev"><i class="fas fa-bolt"></i> EV Grid</a>
    </nav>

    <div class="sos-fab" onclick="openReportModal()" title="Report Hazard">
        <i class="fas fa-exclamation-triangle"></i>
    </div>

    <div id="report-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="close-modal" onclick="closeReportModal()">&times;</div>
            <div style="text-align: center; margin-bottom: 20px;">
                <h2 style="margin:0; font-size: 1.8rem; color: var(--danger-red);"><i class="fas fa-radiation"></i> EMERGENCY REPORT</h2>
                <p style="color:#aaa; font-size: 0.9rem;">Submit hazardous incidents directly to Central Command.</p>
            </div>
            <div class="report-grid">
                <div>
                    <div class="danger-label"><i class="fas fa-crosshairs"></i> PINPOINT INCIDENT</div>
                    <div class="map-wrapper" style="height: 300px; border-color: var(--danger-red);">
                        <div id="report-map"></div>
                    </div>
                    <button class="action-btn" onclick="traceIncidentPath()" style="width:100%; margin-top:10px; border-color:var(--danger-red); color:var(--danger-red);">
                        <i class="fas fa-route"></i> Trace Path (Me -> Incident)
                    </button>
                    <div style="margin-top:10px; font-size: 0.8rem; color:#aaa;">
                        <i class="fas fa-info-circle"></i> Click on the map to set the exact location.
                    </div>
                </div>
                <form onsubmit="submitReport(event)">
                    <div style="display:flex; gap:10px;">
                        <div style="flex:1;"><label class="danger-label">First Name *</label><input type="text" class="danger-input" required></div>
                        <div style="flex:1;"><label class="danger-label">Last Name</label><input type="text" class="danger-input"></div>
                    </div>
                    <div style="display:flex; gap:10px;">
                        <div style="flex:1;"><label class="danger-label">Email ID *</label><input type="email" class="danger-input" required></div>
                        <div style="flex:1;"><label class="danger-label">Mobile</label><input type="tel" class="danger-input"></div>
                    </div>
                    <label class="danger-label">Location Details *</label>
                    <input type="text" id="incident-loc-text" class="danger-input" placeholder="Coordinates from map..." readonly required>
                    <label class="danger-label">Hazard Type</label>
                    <select class="danger-input" required>
                        <option value="">Select...</option>
                        <option value="accident">Major Accident</option>
                        <option value="smog">Zero Visibility Smog</option>
                        <option value="fire">Toxic Fire</option>
                        <option value="industrial">Illegal Discharge</option>
                    </select>
                    <label class="danger-label">Photo Evidence</label>
                    <input type="file" class="danger-input">
                    <div style="display:flex; gap:10px; align-items:center; margin-bottom:10px;">
                        <div id="captcha-display" style="background:#400; padding:8px; color:#fff; letter-spacing:3px; font-family:'Space Grotesk'; border:1px dashed red;">ABCD</div>
                        <input type="text" id="captcha-input" class="danger-input" placeholder="Enter Code" style="margin:0;" required>
                    </div>
                    <button type="submit" class="submit-btn"><i class="fas fa-paper-plane"></i> TRANSMIT REPORT</button>
                </form>
            </div>
        </div>
    </div>

    <section id="home" class="active-section">
        <div id="location-box" style="color:var(--neon-green); margin-bottom:20px; font-family:'Space Grotesk'; font-size: 1.1rem; text-shadow: 0 0 10px var(--neon-green);">
            <i class="fas fa-satellite-dish"></i> Detecting Location...
        </div>
        <div class="aqi-circle">
            <div class="aqi-inner">
                <span class="aqi-number" id="main-aqi">--</span>
                <span style="color:var(--text-muted); letter-spacing:2px;">AQI (PM2.5)</span>
            </div>
        </div>
        <h3 id="aqi-text" style="color: var(--neon-red); letter-spacing: 2px; margin-bottom: 30px; font-weight:700;">ANALYZING AIR...</h3>

        <div class="dashboard-grid">
            <div class="glass-card" id="composition">
                <h4 style="margin-bottom: 15px;"><i class="fas fa-chart-pie"></i> Pollutant Mix</h4>
                <div class="chart-container">
                    <canvas id="pollutantChart"></canvas>
                </div>
            </div>
            <div class="glass-card">
                <h4 style="margin-bottom: 15px; color: var(--neon-yellow);"><i class="fas fa-exclamation-triangle"></i> Primary Causes</h4>
                <ul style="list-style: none; line-height: 2;">
                    <li><i class="fas fa-car-side" style="margin-right:10px;"></i> <strong>Vehicular Emissions</strong> (41%)</li>
                    <li><i class="fas fa-trowel-bricks" style="margin-right:10px;"></i> <strong>Construction Dust</strong> (21%)</li>
                    <li><i class="fas fa-industry" style="margin-right:10px;"></i> <strong>Industrial Waste</strong> (18%)</li>
                </ul>
            </div>
        </div>
    </section>

    <section id="maps">
        <h2>Live Air Quality Zones</h2>
        <div class="external-map-container">
            <iframe src="https://www.aqi.in/in/air-quality-map?map_type=aqi&loc_slug=india" title="AQI India Map"></iframe>
        </div>
    </section>

    <section id="routes">
        <h2><i class="fas fa-route" style="color:var(--neon-blue)"></i> AI Green Navigation</h2>
        <div class="glass-card">
            <div style="display:flex; flex-wrap:wrap; gap:15px; align-items:flex-end;">
                <div style="flex:1; min-width:200px;">
                    <label style="color:var(--neon-blue); font-size:0.8rem;">START</label>
                    <input type="text" class="cyber-input" value="Connaught Place, Delhi" style="margin:0;">
                </div>
                <div style="flex:1; min-width:200px;">
                    <label style="color:var(--neon-blue); font-size:0.8rem;">DESTINATION</label>
                    <input type="text" class="cyber-input" value="Cyber Hub, Gurgaon" style="margin:0;">
                </div>
                <button class="action-btn" onclick="calculateGreenRoute()" style="background:var(--neon-green); color:#000; font-weight:bold; height:45px;">
                    ANALYZE PATH
                </button>
            </div>
        </div>
        <div class="map-wrapper">
            <div id="route-map"></div>
        </div>
    </section>

    <section id="rules">
        <h2>GRAP Protocols</h2>
        <div class="glass-card" style="text-align:center;">
             <strong style="color: var(--neon-red); font-size: 1.5rem;">STAGE III (SEVERE) ACTIVE</strong>
             <p style="color:#aaa;">Violations attract fines up to INR 20,000</p>
        </div>
        <div class="grap-list">
            <div class="grap-item" onclick="toggleGrap(this)">
                <div class="grap-header"><span><i class="fas fa-ban"></i> Vehicle Bans</span><i class="fas fa-chevron-down"></i></div>
                <div class="grap-content">Strict ban on BS-III Petrol and BS-IV Diesel LMVs.</div>
            </div>
            <div class="grap-item" onclick="toggleGrap(this)">
                <div class="grap-header"><span><i class="fas fa-hard-hat"></i> Construction Halt</span><i class="fas fa-chevron-down"></i></div>
                <div class="grap-content">All construction/demolition activities suspended.</div>
            </div>
        </div>
    </section>

    <section id="ev">
        <h2>EV Charging Grid</h2>
        <p style="margin-bottom: 20px; color: var(--text-muted);">Satellite View | Real-time Availability</p>
        <div class="map-wrapper">
            <div id="ev-map"></div>
        </div>
    </section>

    <script>
        let evMap = null, routeMap = null, reportMap = null, generatedCaptcha = "";

        // --- CLICK EFFECT LOGIC ---
        document.addEventListener('click', (e) => {
            const ripple = document.createElement('div');
            ripple.className = 'click-ripple';
            ripple.style.left = `${e.clientX}px`;
            ripple.style.top = `${e.clientY}px`;
            document.body.appendChild(ripple);
            setTimeout(() => ripple.remove(), 600);
        });

        function init() {
            getLocation();
            initCharts();
            initEvMap();
            initRouteMap();
            generateCaptcha();
        }

        function switchTab(tabId) {
            document.querySelectorAll('nav a').forEach(a => a.classList.remove('active'));
            document.querySelectorAll('section').forEach(s => s.classList.remove('active-section'));
            document.getElementById('nav-' + tabId).classList.add('active');
            document.getElementById(tabId).classList.add('active-section');
            setTimeout(() => {
                if (tabId === 'ev' && evMap) evMap.invalidateSize();
                if (tabId === 'routes' && routeMap) routeMap.invalidateSize();
            }, 100);
        }

        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(pos => {
                    document.getElementById('location-box').innerHTML = `<i class="fas fa-map-marker-alt"></i> ${pos.coords.latitude.toFixed(4)}, ${pos.coords.longitude.toFixed(4)} (Delhi NCR)`;
                    setTimeout(() => updateDashboard(342, "HAZARDOUS"), 1500);
                }, () => {
                    document.getElementById('location-box').innerHTML = `<i class="fas fa-map-marker-alt"></i> Location Denied. Showing Delhi.`;
                    updateDashboard(342, "HAZARDOUS");
                });
            }
        }

        function updateDashboard(aqi, status) {
            let current = 0;
            const counter = setInterval(() => {
                current += 5;
                document.getElementById('main-aqi').innerText = current;
                if(current >= aqi) {
                    clearInterval(counter);
                    document.getElementById('main-aqi').innerText = aqi;
                    document.getElementById('aqi-text').innerText = status;
                }
            }, 10);
        }

        function initCharts() {
            const ctx = document.getElementById('pollutantChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['PM 2.5', 'PM 10', 'NO2', 'CO'],
                    datasets: [{
                        data: [45, 30, 15, 10],
                        backgroundColor: ['#ff3fab', '#f1c40f', '#00d2ff', '#9b59b6'],
                        borderWidth: 0
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'right', labels: { color: 'white', font: { family: 'Outfit' } } } } }
            });
        }

        // --- MAPS: COLOURFUL & CLASSY UPDATES ---
        
        function initEvMap() {
            // EV Map: Satellite Imagery (Esri) - High-tech, real world feel
            evMap = L.map('ev-map').setView([28.55, 77.25], 12);
            L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                attribution: 'Tiles &copy; Esri'
            }).addTo(evMap);
            
            const evIcon = L.divIcon({className: 'custom', html: "<div style='background:#00ff9d;width:15px;height:15px;border-radius:50%;box-shadow:0 0 10px #00ff9d; border:2px solid white;'></div>"});
            L.marker([28.55, 77.25], {icon: evIcon}).addTo(evMap).bindPopup("Tata Power Station");
            L.marker([28.58, 77.22], {icon: evIcon}).addTo(evMap).bindPopup("BluSmart Hub");
        }

        function initRouteMap() {
            // Route Map: Esri World Street Map - Classy, Colorful, Detailed
            routeMap = L.map('route-map').setView([28.55, 77.15], 11);
            L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}', {
                attribution: 'Tiles &copy; Esri'
            }).addTo(routeMap);
        }

        function calculateGreenRoute() {
            routeMap.eachLayer(layer => { if(layer instanceof L.Polyline || layer instanceof L.Marker) routeMap.removeLayer(layer); });
            const start = [28.627, 77.215], end = [28.459, 77.026];
            
            // Red path
            L.polyline([start, [28.58, 77.20], [28.52, 77.18], end], {color: '#ff3fab', weight: 5, dashArray: '10, 10', opacity: 0.8}).addTo(routeMap).bindPopup("High AQI Route");
            
            // Green path
            L.polyline([start, [28.60, 77.16], [28.55, 77.12], end], {color: '#00cc7a', weight: 7, opacity: 1}).addTo(routeMap).bindPopup("Green Vayu Route");
            
            L.marker(start).addTo(routeMap); L.marker(end).addTo(routeMap);
            routeMap.fitBounds(L.latLngBounds([start, end]), {padding:[50,50]});
        }

        function openReportModal() {
            document.getElementById('report-modal').style.display = 'flex';
            if (!reportMap) setTimeout(initReportMap, 200); else setTimeout(() => reportMap.invalidateSize(), 200);
        }
        function closeReportModal() { document.getElementById('report-modal').style.display = 'none'; }

        function initReportMap() {
            // Report Map: Satellite View for precise targeting
            reportMap = L.map('report-map').setView([28.61, 77.23], 11);
            L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                attribution: 'Tiles &copy; Esri'
            }).addTo(reportMap);
            
            reportMap.on('click', function(e) {
                reportMap.eachLayer(l => { if(l instanceof L.Marker) reportMap.removeLayer(l); });
                const redIcon = L.divIcon({html: '<i class="fas fa-radiation-alt" style="color:#ff003c; font-size:30px; text-shadow:0 0 10px black;"></i>', className: 'marker-custom', iconSize:[30,30], iconAnchor:[15,15]});
                L.marker(e.latlng, {icon:redIcon}).addTo(reportMap);
                document.getElementById('incident-loc-text').value = `${e.latlng.lat.toFixed(5)}, ${e.latlng.lng.toFixed(5)}`;
            });
        }

        function traceIncidentPath() {
            const user = [28.627, 77.215], center = reportMap.getCenter();
            L.polyline([user, center], { color: 'red', weight: 4, dashArray: '5, 10' }).addTo(reportMap);
            reportMap.fitBounds(L.latLngBounds([user, center]), {padding:[20,20]});
        }

        function toggleGrap(el) {
            const content = el.querySelector('.grap-content');
            content.style.display = content.style.display === 'block' ? 'none' : 'block';
        }

        function generateCaptcha() {
            const chars = "ABCDEF1234567890";
            let code = "";
            for(let i=0; i<4; i++) code += chars[Math.floor(Math.random()*chars.length)];
            generatedCaptcha = code;
            document.getElementById('captcha-display').innerText = code;
        }

        function submitReport(e) {
            e.preventDefault();
            if(document.getElementById('captcha-input').value.toUpperCase() !== generatedCaptcha) { alert("Incorrect Captcha!"); return; }
            alert("EMERGENCY REPORT SENT!");
            closeReportModal();
        }

        window.onload = init;
    </script>
</body>
</html>
